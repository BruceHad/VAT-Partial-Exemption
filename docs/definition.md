A business can be partially exempt from paying VAT. e.g. part of the business is exempt but other parts of the business are not.

Where inputs are purchases and supply/output are sales.

There are rules which define whether a Partially Exempt business can claim back 100% of VAT or just the VAT relating to taxable.

So define:

* _De Minimis_: 100% of VAT is reclaimable
* _Non De Minimis_: VAT related to Taxable Supplies are reclaimable

The De Minimis criteria:

1. Exempt inputs are < £625 per month (on average for the quarter/year so £7,500 per year on average)
2. Exempt inputs are < 50% of total inputs

A business that meets both criteria is consider _De Minimis_ and can reclaim all VAT.

So in order to calculate De Minimis we need to calculate the exempt inputs.

The De Minimis is generally calculated four times a year:

* The first three are on quarterly basis (i.e. the previous three months). 
* The final calculation is based on the full year (previous 12 months). 

Adjustments can be applied at the _year end_ if any of the previous calculation differ from the final i.e. the year end is the one that counts and the previous calculations were basically estimates.

_Exempt Inputs_ for a business are calculated as the:

* VAT wholly attributable to _exempt_ supplies +
* The exempt fraction of the residual VAT.

_Residual_ VAT is the VAT paid on general business expenses that cannot be easily attributed to exempt or taxable supplies.

The fraction is calculated as the percent of _Total Supply_ (i.e the net sales): exempt sales/total sales.

_Total Input_ is all the VAT paid on all types of expenditure: Wholly Attributable + Attributable to Exempt + Residual.

User Inputs
-----------

In order to calcualate all this we need the user to input:

1. The quarterly outputs (net sales) broken down by Exempt/Taxable (Standard + Zero Rated) 
2. Input VAT broken down by Wholly, Exempt and Residual

Quarterly Calculation
---------------------

(For quarters 1, 2 and 3)

Using the quarterly outputs we can calculate the percentage exempt to be applied to the residual calculation.

Then we calculate (for the quarter) the Exempt Input:

* Attributable to Exempt +
* Exempt fraction of the Residual

Then we calculate (for the quarter) the Total Input:

* Wholly Attributable +
* Attributable to Exempt + 
* Total Residual

Then we can calculate the De Minimus:

1. Is the Exempt Input < (£625 * 3)
2. is the Exempt Input < (Total Input / 2)

If both True then De Minimus is True.

Yearly Calculation
------------------

(For quarter 4)

Using the quarterly outputs we can calculate the yearly total and therefore the yearly percentage exempt to be applied to the residual calculation.

Then we calculate (for the year) the Exempt Input:

* Attributable to Exempt +
* Exempt fraction of the Residual

Then we calculate (for the year) the Total Input:

* Wholly Attributable +
* Attributable to Exempt + 
* Total Residual

Then we can calculate the De Minimus:

1. Is the Exempt Input < (£625 * 12)
2. is the Exempt Input < (Total Input / 2)

If both True then De Minimus is True.